angular.module("app",["ui.router","controller.home","controller.userDetail","controller.postDetail"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,r){t.otherwise("/"),e.state("home",{url:"/",templateUrl:"templates/home.html",controller:"homeCtrl"}).state("post",{url:"/post/:postId",templateUrl:"templates/postDetail.html",controller:"postDetailCtrl"}).state("user",{url:"/user/:userId",templateUrl:"templates/userDetail.html",controller:"userDetailCtrl"})}]).controller("AppCtrl",["$scope",function(e){e.app={},e.$on("loading",function(t,r){e.app.loading=r})}]),angular.module("controller.home",["service.user","service.post"]).controller("homeCtrl",["$scope","Post","User",function(e,t,r){e.home={},e.$emit("loading",!0),t.getPosts(function(t){r.getUsers(function(r){_.each(t,function(e){e.user=_.find(r,function(t){return t.id===e.userId})}),e.home.posts=t,e.$emit("loading",!1)})}),e.likePost=function(e){e.liked=!0,t.likedPost(e.id)},e.unlikePost=function(e){e.liked=!1,t.unlikedPost(e.id)}}]),angular.module("controller.postDetail",["service.post","service.user","service.comment"]).controller("postDetailCtrl",["$scope","$stateParams","Post","User","Comment",function(e,t,r,n,o){e.postDetail={},e.$emit("loading",!0),r.getPosts(function(r){e.postDetail.post=_.find(r,function(e){return e.id===parseInt(t.postId,10)}),n.getUsers(function(t){e.postDetail.post.user=_.find(t,function(t){return t.id===e.postDetail.post.userId})}),e.$emit("loading",!1)}),o.getComments(function(r){e.postDetail.comments=r.filter(function(e){return e.postId===parseInt(t.postId,10)})})}]),angular.module("controller.userDetail",["service.user","service.post"]).controller("userDetailCtrl",["$scope","$stateParams","User","Post",function(e,t,r,n){function o(){s&&i&&e.$emit("loading",!1)}e.userDetail={},e.$emit("loading",!0);var s=!1;r.getUsers(function(r){e.userDetail.user=angular.copy(_.find(r,function(e){return e.id===parseInt(t.userId,10)})),s=!0,o()});var i=!1;n.getPosts(function(r){e.userDetail.posts=r.filter(function(e){return e.userId===parseInt(t.userId,10)}),i=!0,o()}),e.saveUser=function(){e.$emit("loading",!0),r.saveUser(e.userDetail.user,function(){e.userDetail.edit=!1,e.$emit("loading",!1),e.userDetail.checkConsoleMessage=!0})}}]),angular.module("service.comment",["service.url"]).service("Comment",["$http","Url",function(e,t){var r=null;return{getComments:function(n){r?n(r):e({method:"GET",url:t.getUrl()+"comments",headers:{"Accept-Language":"en-US"}}).then(function(e){r=e.data,n(r)})}}}]),angular.module("service.post",["service.url"]).service("Post",["$http","Url",function(e,t){var r=null;return{getPosts:function(n){r?n(r):e({method:"GET",url:t.getUrl()+"posts",headers:{"Accept-Language":"en-US"}}).then(function(e){r=e.data,n(r)})},likedPost:function(e){var t=_.find(r,function(t){return t.id===e});t=!0},unlikedPost:function(e){var t=_.find(r,function(t){return t.id===e});t=!1}}}]),angular.module("service.url",[]).service("Url",function(){var e="http://jsonplaceholder.typicode.com/";return{getUrl:function(t){return e}}}),angular.module("service.user",["service.url"]).service("User",["$http","Url",function(e,t){var r=null;return{getUsers:function(n){r?n(r):e({method:"GET",url:t.getUrl()+"users",headers:{"Accept-Language":"en-US"}}).then(function(e){r=e.data,n(r)})},saveUser:function(n,o){var s=_.find(r,function(e){return e.id===n.id});s.name=n.name,s.username=n.username,e({method:"PUT",url:t.getUrl()+"users/"+n.id,data:n}).then(function(e){console.log("Save User:",e),o()})}}}]);